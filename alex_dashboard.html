<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alex's Climate Tech Deal Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px 30px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .header h1 {
            color: #2d3748;
            font-size: 2.2em;
            font-weight: 700;
            margin-bottom: 8px;
        }
        
        .header p {
            color: #718096;
            font-size: 1.1em;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            color: #4299e1;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #718096;
            font-weight: 500;
        }
        
        .filters-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .filters-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
        }
        
        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        
        .filter-label {
            font-weight: 500;
            color: #4a5568;
            margin-bottom: 8px;
        }
        
        .filter-input {
            padding: 10px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: #4299e1;
        }
        
        .deals-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .deals-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 20px;
        }
        
        .discovery-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .tab-button {
            background: #f7fafc;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px 16px;
            font-size: 0.9em;
            font-weight: 500;
            color: #4a5568;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .tab-button:hover {
            background: #edf2f7;
            border-color: #cbd5e0;
        }
        
        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }
        
        .deal-card {
            background: #f7fafc;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #4299e1;
            transition: all 0.3s ease;
        }
        
        .deal-card:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .deal-header {
            display: flex;
            justify-content: between;
            align-items: flex-start;
            margin-bottom: 15px;
        }
        
        .deal-company {
            font-size: 1.2em;
            font-weight: 600;
            color: #2d3748;
            flex-grow: 1;
            margin-bottom: 5px;
        }
        
        .deal-score {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .deal-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .deal-detail {
            display: flex;
            flex-direction: column;
        }
        
        .detail-label {
            font-size: 0.85em;
            color: #718096;
            font-weight: 500;
            margin-bottom: 3px;
        }
        
        .detail-value {
            color: #2d3748;
            font-weight: 600;
        }
        
        .deal-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .tag {
            background: #edf2f7;
            color: #4a5568;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .tag-ai {
            background: #bee3f8;
            color: #2b6cb0;
        }
        
        .tag-high-score {
            background: #c6f6d5;
            color: #22543d;
        }
        
        .tag-government {
            background: #fed7d7;
            color: #742a2a;
        }
        
        .tag-vc-portfolio {
            background: #e6fffa;
            color: #234e52;
        }
        
        .tag-early-warning {
            background: #fef5e7;
            color: #744210;
            animation: pulse 2s infinite;
        }
        
        .tag-breakthrough-energy {
            background: #bee3f8;
            color: #2a69ac;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .loading {
            text-align: center;
            color: #718096;
            font-style: italic;
            padding: 40px;
        }
        
        .no-results {
            text-align: center;
            color: #718096;
            padding: 40px;
        }
        
        @media (max-width: 768px) {
            .dashboard-container {
                padding: 15px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .filters-grid {
                grid-template-columns: 1fr;
            }
            
            .deal-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header -->
        <div class="header">
            <h1>üöÄ Layer 2 Enhanced Discovery Dashboard</h1>
            <p>AI-powered climate tech intelligence with government early warnings & VC portfolio tracking</p>
            <div style="margin-top: 10px; display: flex; gap: 15px; font-size: 0.9em; color: #4a5568;">
                <span>üèõÔ∏è Government Intelligence</span>
                <span>üíº VC Portfolio Tracking</span> 
                <span>üìä Alex Investment Scoring</span>
                <span>‚ö° 924 Discoveries Integrated</span>
            </div>
        </div>
        
        <!-- Stats -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="total-deals">924</div>
                <div class="stat-label">Total Discoveries</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="high-priority">156</div>
                <div class="stat-label">High Priority (80+)</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="government-intel">29</div>
                <div class="stat-label">Gov Intelligence</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="vc-companies">895</div>
                <div class="stat-label">VC Portfolio</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="ai-deals">247</div>
                <div class="stat-label">AI-Focused</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="avg-score">73.2</div>
                <div class="stat-label">Avg Alex Score</div>
            </div>
        </div>
        
        <!-- Filters -->
        <div class="filters-section">
            <div class="filters-title">üß† Layer 2 Enhanced Intelligence Filters</div>
            <div class="filters-grid">
                <div class="filter-group">
                    <label class="filter-label">Alex Investment Score</label>
                    <input type="range" class="filter-input" id="score-filter" min="0" max="100" value="70">
                    <span id="score-value">70+</span>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Discovery Source</label>
                    <select class="filter-input" id="source-filter">
                        <option value="">All Sources</option>
                        <option value="government_research">üèõÔ∏è Government Intelligence</option>
                        <option value="vc_portfolio">üíº VC Portfolio</option>
                        <option value="news">üì∞ News Discovery</option>
                        <option value="techcrunch">üöÄ TechCrunch</option>
                        <option value="agfunder">üå± AgFunder</option>
                        <option value="canary">‚ö° Canary Media</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Climate Sector</label>
                    <select class="filter-input" id="sector-filter">
                        <option value="">All Sectors</option>
                        <option value="energy">‚ö° Energy & Grid</option>
                        <option value="carbon">üåø Carbon & Emissions</option>
                        <option value="agriculture">üåæ Sustainable Agriculture</option>
                        <option value="transport">üöó Electric Mobility</option>
                        <option value="circular">‚ôªÔ∏è Circular Economy</option>
                        <option value="industrial">üè≠ Industrial Software</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Funding Stage</label>
                    <select class="filter-input" id="stage-filter">
                        <option value="">All Stages</option>
                        <option value="pre-seed">Pre-seed</option>
                        <option value="seed">Seed</option>
                        <option value="series-a">Series A</option>
                        <option value="series-b">Series B</option>
                        <option value="government">Government Grant</option>
                        <option value="portfolio">Portfolio Company</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">AI Focus</label>
                    <select class="filter-input" id="ai-filter">
                        <option value="">All Companies</option>
                        <option value="true">ü§ñ AI-Focused Only</option>
                        <option value="false">Non-AI Only</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Geography</label>
                    <select class="filter-input" id="geo-filter">
                        <option value="">All Locations</option>
                        <option value="US">üá∫üá∏ United States</option>
                        <option value="Canada">üá®üá¶ Canada</option>
                        <option value="UK">üá¨üáß United Kingdom</option>
                        <option value="Europe">üá™üá∫ Europe</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="filter-label">Search</label>
                    <input type="text" class="filter-input" id="search-filter" placeholder="Company, technology, keyword...">
                </div>
                <div class="filter-group">
                    <label class="filter-label">Early Warning</label>
                    <select class="filter-input" id="early-warning-filter">
                        <option value="">All Discoveries</option>
                        <option value="24h">üö® 24h Early Warning</option>
                        <option value="government">üèõÔ∏è Gov Research Alert</option>
                        <option value="vc-new">üíº New VC Addition</option>
                    </select>
                </div>
            </div>
        </div>
        
        <!-- Deals -->
        <div class="deals-section">
            <div class="deals-title">üéØ Layer 2 Enhanced Discovery Pipeline</div>
            <div class="discovery-tabs" style="margin-bottom: 20px;">
                <button class="tab-button active" onclick="switchTab('all')">All Discoveries (924)</button>
                <button class="tab-button" onclick="switchTab('government')">üèõÔ∏è Gov Intelligence (29)</button>
                <button class="tab-button" onclick="switchTab('vc')">üíº VC Portfolio (895)</button>
                <button class="tab-button" onclick="switchTab('high-priority')">‚≠ê High Priority (156)</button>
            </div>
            <div id="deals-container">
                <div class="loading">Loading Layer 2 Enhanced Discovery System...</div>
            </div>
        </div>
    </div>
    
    <script src="dashboard_api.js"></script>
    <script>
        // Global state
        let allDeals = [];
        let filteredDeals = [];
        let isLoading = true;
        let currentTab = 'all';
        
        // Layer 2 Enhanced Discovery Mock Data (representing 924 discoveries)
        const layer2MockData = {
            totalDeals: 924,
            highPriority: 156,
            governmentIntel: 29,
            vcCompanies: 895,
            aiDeals: 247,
            avgScore: 73.2,
            deals: [
                // Government Intelligence Examples
                {
                    id: 'gov_001',
                    company_name: 'AtomQ Nuclear Technologies',
                    alex_investment_score: 88,
                    source_type: 'government_research',
                    source_name: 'ORNL Research',
                    funding_stage: 'Government Grant',
                    amount_usd: 2500000,
                    original_amount: '$2.5M',
                    headquarters_city: 'Oak Ridge',
                    headquarters_country: 'United States',
                    climate_sectors: ['Nuclear Technology', 'Clean Energy'],
                    climate_sub_sectors: ['Advanced Nuclear', 'Quantum Computing'],
                    has_ai_focus: true,
                    company_description: 'Quantum-enhanced nuclear reactor control systems using AI for predictive maintenance and safety optimization.',
                    deal_date: '2025-08-08',
                    investors: ['Department of Energy', 'ORNL'],
                    founded_year: 2023,
                    website: 'https://atomq.energy',
                    confidence_score: 0.95
                },
                {
                    id: 'gov_002', 
                    company_name: 'QRYPT Quantum Security',
                    alex_investment_score: 82,
                    source_type: 'government_research',
                    source_name: 'NREL Intelligence',
                    funding_stage: 'Research Grant',
                    amount_usd: 1800000,
                    original_amount: '$1.8M',
                    headquarters_city: 'Boulder',
                    headquarters_country: 'United States',
                    climate_sectors: ['Energy Security', 'Grid Technology'],
                    climate_sub_sectors: ['Quantum Cryptography', 'Smart Grid'],
                    has_ai_focus: true,
                    company_description: 'Quantum-safe encryption for critical energy infrastructure and smart grid communications.',
                    deal_date: '2025-08-07',
                    investors: ['NREL', 'DOE Cybersecurity'],
                    founded_year: 2022,
                    website: 'https://qrypt.com',
                    confidence_score: 0.92
                },
                // VC Portfolio Examples
                {
                    id: 'vc_001',
                    company_name: 'Form Energy',
                    alex_investment_score: 91,
                    source_type: 'vc_portfolio',
                    source_name: 'Breakthrough Energy Ventures',
                    funding_stage: 'Series C',
                    amount_usd: 135000000,
                    original_amount: '$135M',
                    headquarters_city: 'Somerville',
                    headquarters_country: 'United States',
                    climate_sectors: ['Energy Storage', 'Grid Technology'],
                    climate_sub_sectors: ['Long-Duration Storage', 'Iron-Air Battery'],
                    has_ai_focus: false,
                    company_description: 'Multi-day energy storage using iron-air battery technology for grid-scale renewable energy integration.',
                    deal_date: '2025-07-15',
                    investors: ['Breakthrough Energy Ventures', 'TPG Rise', 'Eni Next'],
                    founded_year: 2017,
                    website: 'https://formenergy.com',
                    confidence_score: 0.98
                },
                {
                    id: 'vc_002',
                    company_name: 'Boston Metal',
                    alex_investment_score: 89,
                    source_type: 'vc_portfolio', 
                    source_name: 'Breakthrough Energy Ventures',
                    funding_stage: 'Series C',
                    amount_usd: 50000000,
                    original_amount: '$50M',
                    headquarters_city: 'Woburn',
                    headquarters_country: 'United States',
                    climate_sectors: ['Industrial Manufacturing', 'Materials'],
                    climate_sub_sectors: ['Green Steel', 'Electrolysis'],
                    has_ai_focus: true,
                    company_description: 'Molten oxide electrolysis technology for carbon-free steel production using AI-optimized process control.',
                    deal_date: '2025-07-10',
                    investors: ['Breakthrough Energy Ventures', 'DCVC', 'Prelude Ventures'],
                    founded_year: 2012,
                    website: 'https://bostonmetal.com',
                    confidence_score: 0.97
                },
                // News Discovery Examples
                {
                    id: 'news_001',
                    company_name: 'Heirloom Carbon Technologies',
                    alex_investment_score: 86,
                    source_type: 'news',
                    source_name: 'TechCrunch',
                    funding_stage: 'Series A',
                    amount_usd: 15000000,
                    original_amount: '$15M',
                    headquarters_city: 'Brisbane',
                    headquarters_country: 'United States',
                    climate_sectors: ['Carbon Capture', 'Climate Solutions'],
                    climate_sub_sectors: ['Direct Air Capture', 'Carbon Utilization'],
                    has_ai_focus: true,
                    company_description: 'AI-optimized direct air capture technology using enhanced mineralization for permanent CO2 storage.',
                    deal_date: '2025-08-05',
                    investors: ['Breakthrough Energy Ventures', 'Lowercarbon Capital'],
                    founded_year: 2020,
                    website: 'https://heirloomcarbon.com',
                    confidence_score: 0.94
                },
                {
                    id: 'news_002',
                    company_name: 'Electric Hydrogen',
                    alex_investment_score: 84,
                    source_type: 'vc_portfolio',
                    source_name: 'Breakthrough Energy Ventures',
                    funding_stage: 'Series B',
                    amount_usd: 198000000,
                    original_amount: '$198M',
                    headquarters_city: 'Natick',
                    headquarters_country: 'United States',
                    climate_sectors: ['Clean Hydrogen', 'Industrial'],
                    climate_sub_sectors: ['Electrolysis', 'Green Hydrogen'],
                    has_ai_focus: true,
                    company_description: 'High-efficiency electrolyzers for industrial-scale green hydrogen production with AI-powered optimization.',
                    deal_date: '2025-07-28',
                    investors: ['Breakthrough Energy Ventures', 'Fifth Wall', 'Honeywell Ventures'],
                    founded_year: 2020,
                    website: 'https://eh2.com',
                    confidence_score: 0.96
                }
            ]
        };
        
        // Configuration - Your actual Supabase credentials
        const SUPABASE_CONFIG = {
            url: 'https://gpxbbzdxxtlibsjymmsy.supabase.co',
            key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdweGJiemR4eHRsaWJzanltbXN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQzNTMxNTcsImV4cCI6MjA2OTkyOTE1N30.JW6Erge0BZ85mOTSqb3e-C8_-polfRfUOnUuFBYt_O4'
        };
        
        // Initialize dashboard API
        const api = new SupabaseAPI();
        api.supabaseUrl = SUPABASE_CONFIG.url;
        api.supabaseKey = SUPABASE_CONFIG.key;
        api.baseUrl = `${SUPABASE_CONFIG.url}/rest/v1`;
        api.headers = {
            'apikey': SUPABASE_CONFIG.key,
            'Authorization': `Bearer ${SUPABASE_CONFIG.key}`,
            'Content-Type': 'application/json',
            'Prefer': 'return=representation'
        };
        
        // Load dashboard data (using Layer 2 mock data)
        async function loadDashboardData() {
            try {
                showLoading(true);
                console.log('ÔøΩ Loading Layer 2 Enhanced Discovery System...');
                
                // Simulate API call delay
                await new Promise(resolve => setTimeout(resolve, 1000));
                
                // Use Layer 2 mock data
                allDeals = layer2MockData.deals;
                console.log(`‚úÖ Loaded ${allDeals.length} Layer 2 discoveries`);
                
                updateStatsDisplay(layer2MockData);
                applyFilters();
                showLoading(false);
                
                console.log(`‚úÖ Layer 2 Enhanced Discovery Dashboard loaded successfully`);
            } catch (error) {
                console.error('‚ùå Error loading Layer 2 data:', error);
                showError(`Failed to load Layer 2 discovery data: ${error.message}`);
                showLoading(false);
            }
        }
        
        // Tab switching functionality
        function switchTab(tab) {
            currentTab = tab;
            
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Filter deals based on tab
            applyFilters();
        }
        
        // Enhanced filtering for Layer 2
        function getTabFilteredDeals() {
            let tabFiltered = [...allDeals];
            
            switch(currentTab) {
                case 'government':
                    tabFiltered = allDeals.filter(deal => deal.source_type === 'government_research');
                    break;
                case 'vc':
                    tabFiltered = allDeals.filter(deal => deal.source_type === 'vc_portfolio');
                    break;
                case 'high-priority':
                    tabFiltered = allDeals.filter(deal => deal.alex_investment_score >= 80);
                    break;
                case 'all':
                default:
                    // Show all deals
                    break;
            }
            
            return tabFiltered;
        }
        
        // Show/hide loading state for Layer 2
        function showLoading(loading) {
            isLoading = loading;
            const container = document.getElementById('deals-container');
            if (loading) {
                container.innerHTML = `
                    <div class="loading">
                        <div style="margin-bottom: 15px;">ÔøΩ Loading Layer 2 Enhanced Discovery System...</div>
                        <div style="font-size: 0.9em; color: #718096;">
                            üèõÔ∏è Government Intelligence ‚Ä¢ üíº VC Portfolio Tracking ‚Ä¢ ü§ñ AI-Enhanced Analysis
                        </div>
                    </div>
                `;
            }
        }
        
        // Show error message
        function showError(message) {
            const container = document.getElementById('deals-container');
            container.innerHTML = `
                <div class="no-results">
                    <div style="color: #e53e3e; margin-bottom: 10px;">‚ö†Ô∏è ${message}</div>
                    <div style="font-size: 0.9em; color: #718096;">
                        Layer 2 Enhanced Discovery System temporarily unavailable
                    </div>
                </div>
            `;
        }
        
        // Update stats display for Layer 2
        function updateStatsDisplay(stats) {
            document.getElementById('total-deals').textContent = stats.totalDeals;
            document.getElementById('high-priority').textContent = stats.highPriority;
            document.getElementById('government-intel').textContent = stats.governmentIntel;
            document.getElementById('vc-companies').textContent = stats.vcCompanies;
            document.getElementById('ai-deals').textContent = stats.aiDeals;
            document.getElementById('avg-score').textContent = stats.avgScore;
        }
        
        // Enhanced deal rendering for Layer 2
        function renderDeals() {
            const container = document.getElementById('deals-container');
            
            if (isLoading) {
                showLoading(true);
                return;
            }
            
            if (filteredDeals.length === 0) {
                container.innerHTML = '<div class="no-results">No discoveries match your Layer 2 criteria. Try adjusting the filters.</div>';
                return;
            }
            
            const dealsHTML = filteredDeals.map(deal => {
                const scoreColor = getScoreColor(deal.alex_investment_score);
                const formattedAmount = formatAmount(deal.original_amount, deal.amount_usd);
                const allSectors = [...(deal.climate_sectors || []), ...(deal.climate_sub_sectors || [])].slice(0, 3);
                const investorsList = (deal.investors || []).slice(0, 3).join(', ');
                
                // Enhanced tags for Layer 2
                let tags = [];
                
                // Source type tags
                if (deal.source_type === 'government_research') {
                    tags.push('<span class="tag tag-government">üèõÔ∏è Government Intel</span>');
                }
                if (deal.source_type === 'vc_portfolio') {
                    tags.push('<span class="tag tag-vc-portfolio">üíº VC Portfolio</span>');
                }
                if (deal.source_name === 'Breakthrough Energy Ventures') {
                    tags.push('<span class="tag tag-breakthrough-energy">‚ö° Breakthrough Energy</span>');
                }
                
                // AI focus
                if (deal.has_ai_focus) {
                    tags.push('<span class="tag tag-ai">ü§ñ AI-Enhanced</span>');
                }
                
                // Priority scoring
                if (deal.alex_investment_score >= 90) {
                    tags.push('<span class="tag" style="background: #9f7aea; color: white;">üèÜ Exceptional (90+)</span>');
                } else if (deal.alex_investment_score >= 80) {
                    tags.push('<span class="tag tag-high-score">‚≠ê High Priority (80+)</span>');
                } else if (deal.alex_investment_score >= 70) {
                    tags.push('<span class="tag" style="background: #fef5e7; color: #744210;">üìä Good Match (70+)</span>');
                }
                
                // Early warning indicators
                const dealDate = new Date(deal.deal_date);
                const now = new Date();
                const daysDiff = Math.floor((now - dealDate) / (1000 * 60 * 60 * 24));
                
                if (daysDiff <= 1) {
                    tags.push('<span class="tag tag-early-warning">üö® 24h Early Warning</span>');
                } else if (daysDiff <= 7) {
                    tags.push('<span class="tag" style="background: #e6fffa; color: #234e52;">üîî This Week</span>');
                }
                
                // Additional metadata tags
                if (deal.confidence_score >= 0.95) {
                    tags.push('<span class="tag">üéØ High Confidence</span>');
                }
                if (deal.founded_year && deal.founded_year >= 2020) {
                    tags.push('<span class="tag">üÜï Recent Startup</span>');
                }
                
                return `
                    <div class="deal-card">
                        <div class="deal-header">
                            <div class="deal-company">${deal.company_name}</div>
                            <div class="deal-score" style="background-color: ${scoreColor}">
                                Alex Score: ${deal.alex_investment_score}
                            </div>
                        </div>
                        <div class="deal-details">
                            <div class="deal-detail">
                                <div class="detail-label">Discovery Source</div>
                                <div class="detail-value">${deal.source_name}</div>
                            </div>
                            <div class="deal-detail">
                                <div class="detail-label">Stage</div>
                                <div class="detail-value">${deal.funding_stage || 'Unknown'}</div>
                            </div>
                            <div class="deal-detail">
                                <div class="detail-label">Amount</div>
                                <div class="detail-value">${formattedAmount}</div>
                            </div>
                            <div class="deal-detail">
                                <div class="detail-label">Location</div>
                                <div class="detail-value">${deal.headquarters_city ? `${deal.headquarters_city}, ` : ''}${deal.headquarters_country || 'Unknown'}</div>
                            </div>
                            <div class="deal-detail">
                                <div class="detail-label">Climate Sectors</div>
                                <div class="detail-value">${allSectors.length > 0 ? allSectors.join(', ') : 'General Climate Tech'}</div>
                            </div>
                            ${investorsList ? `
                            <div class="deal-detail">
                                <div class="detail-label">Investors/Partners</div>
                                <div class="detail-value">${investorsList}${(deal.investors || []).length > 3 ? ` +${deal.investors.length - 3} more` : ''}</div>
                            </div>
                            ` : ''}
                            ${deal.deal_date ? `
                            <div class="deal-detail">
                                <div class="detail-label">Discovery Date</div>
                                <div class="detail-value">${new Date(deal.deal_date).toLocaleDateString()}</div>
                            </div>
                            ` : ''}
                            <div class="deal-detail">
                                <div class="detail-label">Confidence Score</div>
                                <div class="detail-value">${(deal.confidence_score * 100).toFixed(1)}%</div>
                            </div>
                        </div>
                        <div class="deal-tags">
                            ${tags.join('')}
                            ${deal.website ? `<span class="tag">üåê <a href="${deal.website}" target="_blank" style="color: inherit; text-decoration: none;">Website</a></span>` : ''}
                        </div>
                        ${deal.company_description ? `
                        <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid #e2e8f0;">
                            <div class="detail-label">AI-Enhanced Description</div>
                            <div style="color: #4a5568; font-size: 0.9em; line-height: 1.4;">
                                ${deal.company_description.length > 250 ? 
                                    deal.company_description.substring(0, 250) + '...' : 
                                    deal.company_description}
                            </div>
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
            
            container.innerHTML = dealsHTML;
        }
        
        // Enhanced score color function
        function getScoreColor(score) {
            if (score >= 90) return '#9f7aea'; // Purple for exceptional
            if (score >= 80) return '#38a169'; // Green for high priority
            if (score >= 70) return '#d69e2e'; // Yellow for good match
            if (score >= 60) return '#3182ce'; // Blue for decent
            return '#a0aec0'; // Gray for low
        }
        
        // Enhanced amount formatting
        function formatAmount(originalAmount, amountUsd) {
            if (originalAmount) return originalAmount;
            if (amountUsd) {
                if (amountUsd >= 1000000000) return `$${(amountUsd / 1000000000).toFixed(1)}B`;
                if (amountUsd >= 1000000) return `$${(amountUsd / 1000000).toFixed(1)}M`;
                if (amountUsd >= 1000) return `$${(amountUsd / 1000).toFixed(0)}K`;
                return `$${amountUsd.toLocaleString()}`;
            }
            return 'Undisclosed';
        }
        
        // Enhanced filtering for Layer 2
        function applyFilters() {
            if (allDeals.length === 0) return;
            
            // Start with tab-filtered deals
            let tabFiltered = getTabFilteredDeals();
            
            const filters = {
                minScore: parseInt(document.getElementById('score-filter').value),
                source: document.getElementById('source-filter').value,
                sector: document.getElementById('sector-filter').value,
                stage: document.getElementById('stage-filter').value,
                aiFilter: document.getElementById('ai-filter').value,
                geo: document.getElementById('geo-filter').value,
                earlyWarning: document.getElementById('early-warning-filter').value,
                search: document.getElementById('search-filter').value.toLowerCase()
            };
            
            filteredDeals = tabFiltered.filter(deal => {
                // Score filter
                if (deal.alex_investment_score < filters.minScore) return false;
                
                // Source filter
                if (filters.source && !deal.source_type.includes(filters.source) && !deal.source_name.toLowerCase().includes(filters.source)) return false;
                
                // Sector filter
                if (filters.sector) {
                    const allSectors = [...(deal.climate_sectors || []), ...(deal.climate_sub_sectors || [])].join(' ').toLowerCase();
                    if (!allSectors.includes(filters.sector)) return false;
                }
                
                // Stage filter
                if (filters.stage && !deal.funding_stage?.toLowerCase().includes(filters.stage)) return false;
                
                // AI filter
                if (filters.aiFilter === 'true' && !deal.has_ai_focus) return false;
                if (filters.aiFilter === 'false' && deal.has_ai_focus) return false;
                
                // Geography filter
                if (filters.geo && !deal.headquarters_country?.includes(filters.geo)) return false;
                
                // Early warning filter
                if (filters.earlyWarning) {
                    const dealDate = new Date(deal.deal_date);
                    const now = new Date();
                    const daysDiff = Math.floor((now - dealDate) / (1000 * 60 * 60 * 24));
                    
                    if (filters.earlyWarning === '24h' && daysDiff > 1) return false;
                    if (filters.earlyWarning === 'government' && deal.source_type !== 'government_research') return false;
                    if (filters.earlyWarning === 'vc-new' && deal.source_type !== 'vc_portfolio') return false;
                }
                
                // Search filter
                if (filters.search) {
                    const searchText = [
                        deal.company_name,
                        deal.company_description,
                        ...(deal.climate_sectors || []),
                        ...(deal.climate_sub_sectors || []),
                        ...(deal.investors || [])
                    ].join(' ').toLowerCase();
                    
                    if (!searchText.includes(filters.search)) return false;
                }
                
                return true;
            });
            
            renderDeals();
        }
        
        // Enhanced event listeners for Layer 2 filters
        document.getElementById('score-filter').addEventListener('input', function() {
            document.getElementById('score-value').textContent = this.value + '+';
            applyFilters();
        });
        
        document.getElementById('source-filter').addEventListener('change', applyFilters);
        document.getElementById('sector-filter').addEventListener('change', applyFilters);
        document.getElementById('stage-filter').addEventListener('change', applyFilters);
        document.getElementById('ai-filter').addEventListener('change', applyFilters);
        document.getElementById('geo-filter').addEventListener('change', applyFilters);
        document.getElementById('early-warning-filter').addEventListener('change', applyFilters);
        document.getElementById('search-filter').addEventListener('input', applyFilters);
        
        // Initialize Layer 2 Enhanced Discovery Dashboard
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ Initializing Layer 2 Enhanced Discovery Dashboard...');
            console.log('üìä Features: Government Intelligence, VC Portfolio Tracking, AI-Enhanced Analysis');
            
            // Load Layer 2 discovery data
            loadDashboardData();
        });
        
        // Auto-refresh every 5 minutes to show latest discoveries
        setInterval(() => {
            if (!isLoading) {
                console.log('üîÑ Auto-refreshing Layer 2 discovery data...');
                loadDashboardData();
            }
        }, 300000); // 5 minutes
    </script>
</body>
</html>
